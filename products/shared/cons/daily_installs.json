{
  "sources": [{
    "location": "{{datastore.location}}/devices/installs/event_date={{event_date}}"
  }],
  "targets": [{
    "location": "{{datastore.location}}/cons/daily_installs",
    "partition_by": ["event_date"],
    "columns": [
      { "name": "product_id" },
      { "name": "event_date" },
      { "name": "install_id" },
      { "name": "media_source" },
      { "name": "campaign_id" },
      { "name": "country_code" },
      { "name": "platform" }
    ],
    "query": ["fillna(na,media_source,campaign_id,country_code,platform)"],
    "agg": {
      "type": "group_by",
      "dimensions": ["product_id","event_date","media_source","campaign_id","country_code","platform"],
      "metrics": [
        {"name": "installs", "funcs": ["count_distinct(install_id)"]}
      ]
    }
  }]
}